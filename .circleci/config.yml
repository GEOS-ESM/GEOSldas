version: 2.1

orbs:
  circleci-tools: geos-esm/circleci-tools@0.13.0

workflows:
  build-test:
    jobs:
      - build-GEOSldas:
          name: build-GEOSldas-on-<< matrix.compiler >>
          matrix:
            parameters:
              compiler: [gfortran, ifort]
          context:
            - docker-hub-creds

jobs:
  build-GEOSldas:
    parameters:
      compiler:
        type: string
    executor:
      name: circleci-tools/<< parameters.compiler >>
      resource_class: large
    working_directory: /root/project
    steps:
      - checkout:
          path: GEOSldas
      - circleci-tools/versions:
          compiler: << parameters.compiler >>
      - circleci-tools/mepoclone:
          repo: GEOSldas
      - circleci-tools/checkout_if_exists:
          repo: GEOSldas
      - circleci-tools/cmake:
          repo: GEOSldas
          compiler: << parameters.compiler >>
      - circleci-tools/buildinstall:
          repo: GEOSldas
      - circleci-tools/compress_artifacts
      - store_artifacts:
          path: /logfiles
